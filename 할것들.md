# Mammoth A2P — 할 것들 (TODO)

> 최종 업데이트: 2026-02-21

---

## 1. 현재 완성된 부분 ✅

| 영역 | 파일 | 라인 수 | 상태 |
|---|---|---|---|
| **Node Daemon 전체 API** | `services/node-daemon/server.mjs` | 3,081 | ✅ 에이전트 등록/펀딩, Intent/Action, A2A 6종, Market Q&A 3모드, 정산, 평판, Barter 의무 |
| **CLI 전체 명령어** | `apps/cli/mammoth.mjs` | 1,686 | ✅ quickstart, doctor, wizard, agent/intent/a2a/market/claim/peer/crypto |
| **MCP 서버** | `services/node-daemon/mammoth-mcp.mjs` | 485 | ✅ 17개 도구 — OpenCode AI 연동 |
| **Observer Web** | `apps/observer-web/server.mjs` | 856 | ✅ 프리미엄 다크 UI, 실시간 타임라인, 메트릭 대시보드 |
| **P2P 동기화** | `server.mjs` 내장 | — | ✅ 스냅샷 기반 merge, 20초 자동 루프 |
| **Ethereum 입금 검증** | `server.mjs` 내장 | — | ✅ ERC20 Transfer log 파싱 (USDC/USDT) |
| **프로토콜 스키마** | `packages/protocol/` | 4 파일 | ✅ AIM, AOF, PoA, A2A Message |
| **SDK 클라이언트** | `packages/sdk/client.mjs` | 69 | ✅ MammothClient 기본 메서드 |
| **실행 스크립트** | `scripts/*.ps1` | 113 | ✅ 데몬+옵저버 동시 실행/종료 |

---

## 2. 미완성 / 구린 부분 ❌

| 영역 | 현재 상태 | 문제점 | 우선순위 |
|---|---|---|---|
| **TUI v1/v2** | 기본 ANSI 렌더링, 버그 多 | 리사이즈 깨짐, AI 채팅 불안정, 슬래시 커맨드 미완성, Codex/Claude CLI 대비 매우 부족 | 🔴 높음 |
| **데이터베이스** | `state.json` 파일 저장 | 동시 접근 문제, 대용량 불가, 쿼리 불가, 프로덕션 절대 불가 | 🔴 높음 |
| **보안/인증** | 하드코딩 토큰 `local-dev-token` | Ed25519 서명 없음, 리플레이 방어 없음, 키 관리 없음 | 🔴 높음 |
| **P2P 전송** | 순수 HTTP fetch | libp2p 아님, NAT 통과 불가, 디스커버리 수동 | 🟡 중간 |
| **테스트** | 0개 | 단위/통합 테스트 전혀 없음 | 🔴 높음 |
| **Docker/CI** | 없음 | 수동 node 실행만 가능, 배포 파이프라인 없음 | 🟡 중간 |
| **타입 정의** | 없음 | TypeScript 타입/JSDoc 없음 | 🟢 낮음 |
| **Observer Web 차트** | 숫자 나열만 | 그래프/시각화 없음 | 🟡 중간 |

---

## 3. 팀 분배 (3인)

### 👤 Person A — TUI/CLI 전문가

> **목표**: Codex CLI / Claude CLI 수준의 프로덕션급 터미널 인터페이스

**담당 파일**: `mammoth-tui-v2.mjs`, `mammoth-tui.mjs`, `mammoth.mjs`

**Week 1-2: TUI 코어 재작성**
- [ ] 풀스크린 렌더링 엔진 안정화 (리사이즈, 유니코드 깨짐 수정)
- [ ] 3-column 레이아웃 정밀 구현 (좌: 파일/세션, 중: 채팅, 우: 에이전트/마켓)
- [ ] 키보드 네비게이션 (Tab 패널 전환, ↑↓ 스크롤, Ctrl+C 안전 종료)
- [ ] 입력창 개선 (히스토리, 자동완성, 멀티라인)

**Week 3-4: AI 채팅 엔진**
- [ ] Gemini/Claude/GPT 멀티모델 스위칭 (`/model gemini`, `/model claude`)
- [ ] 스트리밍 응답 실시간 렌더링 (한 글자씩 출력)
- [ ] 대화 히스토리 세션 관리 (저장/불러오기)
- [ ] 시스템 프롬프트에 Mammoth 컨텍스트 자동 주입

**Week 5-6: Mammoth 통합 + 폴리싱**
- [ ] 슬래시 커맨드 전체 구현 (`/agent`, `/market`, `/ask`, `/peer`, `/claim` 등)
- [ ] 실시간 이벤트 스트림 우측 패널
- [ ] 에러 핸들링, 로딩 스피너, 상태 표시
- [ ] Windows/Mac/Linux 터미널 호환성 테스트

**참고 레퍼런스**: [Codex CLI](https://github.com/openai/codex), [Claude Code](https://docs.anthropic.com/en/docs/claude-code)

---

### 👤 Person B — 백엔드/프로토콜 엔진

> **목표**: MVP → 프로덕션급 백엔드 (DB, 보안, P2P 안정화)

**담당 파일**: `server.mjs`, `mammoth-mcp.mjs`, `packages/protocol/`, `packages/sdk/`, `packages/common/`

**Week 1-2: 데이터 계층 교체**
- [ ] `state.json` → SQLite (better-sqlite3) 마이그레이션
- [ ] 스키마 설계: agents, intents, actions, messages, claims, market_*, events 테이블
- [ ] 마이그레이션 스크립트 (기존 state.json → SQLite 자동 변환)
- [ ] 트랜잭션 기반 상태 저장 (원자성 보장)

**Week 3-4: 보안 레이어**
- [ ] Ed25519 키 생성/저장 (`node:crypto` 활용)
- [ ] 모든 API 요청에 서명 검증 미들웨어
- [ ] nonce + timestamp 리플레이 방어
- [ ] 키 로테이션 API (`/v1/node/rotate-key`)
- [ ] 에이전트별 개별 키페어 관리

**Week 5-6: P2P + 프로토콜 확장**
- [ ] 피어 디스커버리 개선 (gossip 프로토콜 or 부트스트랩 노드)
- [ ] 스냅샷 동기화 diff 최적화 (전체 → 델타 sync)
- [ ] 충돌 해소 로직 강화 (CRDT-like merge)
- [ ] MCP 도구 확장 (bulk operations, 통계, 모니터링)
- [ ] SDK에 TypeScript 타입 정의 추가

---

### 👤 Person C — 프론트엔드 + DevOps

> **목표**: Observer Web 고도화 + 배포 파이프라인 + 테스트

**담당 파일**: `observer-web/server.mjs`, `scripts/`, `package.json`, 신규 `Dockerfile`, `docker-compose.yml`, `tests/`, `.github/workflows/`

**Week 1-2: Observer Web 고도화**
- [ ] 차트 라이브러리 추가 (Chart.js or D3 — CDN)
- [ ] 에이전트 평판 추이 그래프
- [ ] 마켓 거래량/정산 히스토리 시각화
- [ ] 에이전트 상세 페이지 (클릭 → 드릴다운)
- [ ] 반응형 모바일 UI 개선
- [ ] 다크/라이트 테마 토글

**Week 3-4: DevOps 파이프라인**
- [ ] Dockerfile 작성 (node-daemon + observer-web)
- [ ] `docker-compose.yml` (원클릭 실행)
- [ ] GitHub Actions CI: lint + test on PR
- [ ] GitHub Actions CD: Docker 이미지 빌드 + 태그
- [ ] 환경변수 `.env.example` 문서화

**Week 5-6: 테스트 인프라**
- [ ] 단위 테스트 (`node:test` — 외부 의존성 없이)
- [ ] 통합 테스트: quickstart → market → claim 전체 시나리오
- [ ] E2E 스크립트: 데몬 시작 → CLI 명령 → 상태 검증
- [ ] README에 테스트 실행 가이드 추가

---

## 4. 의존성 & 일정

```
Person B (백엔드) ──▶ Person A (TUI)
                 ──▶ Person C (프론트+DevOps)

Week 1-2: 3명 독립 작업 가능
Week 2 체크포인트: B가 SQLite 완료 → A, C에 API 변경 공유
Week 4 체크포인트: B가 서명 완성 → A의 TUI 인증 반영, C가 통합 테스트
Week 6 최종: 전원 merge → Docker 빌드 + 전체 E2E
```

## 5. 커뮤니케이션 규칙

1. **API 변경은 반드시 PR + 스키마 업데이트** (`packages/protocol/`)
2. **Breaking change는 최소 2일 전 공지**
3. **매주 금요일 15분 동기화 미팅** (진행상황 + 블로커)
